---
import type { GetStaticPaths } from "astro";
import { createReader } from "@keystatic/core/reader";
import keystaticConfig from "../../../keystatic.config";
import { DocumentRenderer } from "@keystatic/core/renderer";

export const getStaticPaths = (async () => {
  const reader = createReader(process.cwd(), keystaticConfig);

  console.log(reader);
  console.log(Object.keys(reader.collections));

  const sections = Object.keys(reader.collections);

  let params = sections.map(async (section) => {
    const posts = await reader.collections.posts.all();

    return Promise.all(
      posts.map(async (post) => {
        const postContent = await post.entry.content();
        return {
          params: { section, item: post.slug },
          props: { content: postContent },
        };
      }),
    );
  }, []);

  const result = (await Promise.all(params)).flat();

  return result;
}) satisfies GetStaticPaths;

const { params, props } = Astro;
---
{props.content}
<div>{params.item}</div>
